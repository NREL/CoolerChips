<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cost Model Demonstration V1.1</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        .container-fluid {
            margin-left: 10px;
            margin-right: 10px;
        }
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        .table thead th, .table tbody td {
            vertical-align: middle;
            white-space: nowrap;
        }
        .form-control {
            padding: 0.375rem 0.75rem;
            height: auto;
        }
        .graph-container {
            margin-top: 20px;
            text-align: center;
        }
        .editable {
            background-color: #f9f9f9;
        }
        .table-wider th, .table-wider td {
            min-width: 120px;
        }
        .sub-column {
            display: flex;
            justify-content: space-between;
        }
        .checkbox-column {
            width: 30px; /* Adjust this value to make the checkbox column narrower */
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1 class="mt-4">Cost Model Demonstration V1.1</h1>

        <div class="mt-3">
            <a href="/settings" class="btn btn-secondary" onclick="saveState()">Settings</a>
            <a href="/elements.html" class="btn btn-secondary" onclick="saveState()">Cost Elements Menu</a>
            <button class="btn btn-secondary" id="saveBtn" onclick="saveState()">Save</button>
            <button class="btn btn-secondary" id="loadBtn">Load</button>
        </div>

        <form id="fileForm" method="post" action="/process_file" enctype="multipart/form-data" onsubmit="return handleFormSubmit(event);">
            <div class="form-group" id="file1-group">
                <label for="file1">Add the first HTM/SQL file:</label>
                <input type="file" class="form-control" id="file1" name="file1" onchange="showFileModal(this, 'file1')">
                <div class="mt-2 mb-2">
                    <button type="button" class="btn btn-primary" onclick="showAddModal()">Add</button>
                    <button type="button" class="btn btn-danger" onclick="removeSelectedRows('file1')">Remove</button>
                    <button type="button" class="btn btn-warning" onclick="clearTable('file1')">Clear</button>
                </div>
                <div class="table-container">
                    <table class="table table-bordered table-wider" id="file1-table">
                        <thead>
                            <tr>
                                <th class="checkbox-column"></th>
                                <th rowspan="2">Name</th>
                                <th rowspan="2">Units</th>
                                <th rowspan="2">Cost per Equipment</th>
                                <th rowspan="2">Redundancy</th>
                                <th rowspan="2">MTBF</th>
                                <th rowspan="2">Gamma (hours)</th>
                                <th rowspan="2">Beta</th>
                                <th rowspan="2">Eta (hours)</th>
                                <th colspan="2">Cost per Maintenance Event</th>
                                <th rowspan="2">Total Cost</th>
                            </tr>
                            <tr>
                                <th><input type="checkbox" id="selectAllFile1"></th>
                                <th>Original Cost</th>
                                <th>Maintenance Type</th>
                            </tr>
                        </thead>
                        <tbody id="file1-details">
                            {% if table_data_file1 %}
                                {% for key, value in table_data_file1.items() %}
                                    <tr>
                                        <td class="checkbox-column"><input type="checkbox" class="selectRowFile1"></td>
                                        <td>{{ key }}</td>
                                        <td>{{ value }}</td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="11">Total</th>
                                <th id="file1-totalCost">{{ table_data_file1|length > 1 and table_data_file1.values()|last }}</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <div class="form-group" id="file2-group">
                <label for="file2">Add the second HTM/SQL file:</label>
                <input type="file" class="form-control" id="file2" name="file2" onchange="showFileModal(this, 'file2')">
                <div class="mt-2 mb-2">
                    <button type="button" class="btn btn-primary" onclick="showAddModal()">Add</button>
                    <button type="button" class="btn btn-danger" onclick="removeSelectedRows('file2')">Remove</button>
                    <button type="button" class="btn btn-warning" onclick="clearTable('file2')">Clear</button>
                </div>
                <div class="table-container">
                    <table class="table table-bordered table-wider" id="file2-table">
                        <thead>
                            <tr>
                                <th class="checkbox-column"></th>
                                <th rowspan="2">Name</th>
                                <th rowspan="2">Units</th>
                                <th rowspan="2">Cost per Equipment</th>
                                <th rowspan="2">Redundancy</th>
                                <th rowspan="2">MTBF</th>
                                <th rowspan="2">Gamma (hours)</th>
                                <th rowspan="2">Beta</th>
                                <th rowspan="2">Eta (hours)</th>
                                <th colspan="2">Cost per Maintenance Event</th>
                                <th rowspan="2">Total Cost</th>
                            </tr>
                            <tr>
                                <th><input type="checkbox" id="selectAllFile2"></th>
                                <th>Original Cost</th>
                                <th>Maintenance Type</th>
                            </tr>
                        </thead>
                        <tbody id="file2-details">
                            {% if table_data_file2 %}
                                {% for key, value in table_data_file2.items() %}
                                    <tr>
                                        <td class="checkbox-column"><input type="checkbox" class="selectRowFile2"></td>
                                        <td>{{ key }}</td>
                                        <td>{{ value }}</td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="11">Total</th>
                                <th id="file2-totalCost">{{ table_data_file2|length > 1 and table_data_file2.values()|last }}</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>

        <div class="graph-container">
            <h2>Graphs</h2>
            <div>
                <h3>ROI Graph</h3>
                <div id="roi-graph"></div>
            </div>
            <div>
                <h3>IRR Graph</h3>
                <div id="irr-graph"></div>
            </div>
            <div>
                <h3>NPV Graph</h3>
                <div id="npv-graph"></div>
            </div>
        </div>
    </div>

    <!-- Modal for file input -->
    <div class="modal fade" id="fileInputModal" tabindex="-1" role="dialog" aria-labelledby="fileInputModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fileInputModalLabel">Enter Values for File</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="fileModalForm">
                        <div class="form-group">
                            <label for="fileModalMTBF">MTBF:</label>
                            <input type="text" class="form-control" id="fileModalMTBF">
                        </div>
                        <div class="form-group">
                            <label for="fileModalGamma">Gamma (hours):</label>
                            <input type="text" class="form-control" id="fileModalGamma">
                        </div>
                        <div class="form-group">
                            <label for="fileModalBeta">Beta:</label>
                            <input type="text" class="form-control" id="fileModalBeta">
                        </div>
                        <div class="form-group">
                            <label for="fileModalEta">Eta (hours):</label>
                            <input type="text" class="form-control" id="fileModalEta">
                        </div>
                        <div class="form-group">
                            <label for="fileModalCostPerMaintenanceEvent">Cost per Maintenance Event:</label>
                            <input type="text" class="form-control" id="fileModalCostPerMaintenanceEvent">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitFileModalForm()">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for adding new entry -->
    <div class="modal fade" id="inputModal" tabindex="-1" role="dialog" aria-labelledby="inputModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="inputModalLabel">Enter Values</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="modalForm">
                        <div class="form-group">
                            <label for="modalName">Name:</label>
                            <input type="text" class="form-control" id="modalName">
                        </div>
                        <div class="form-group">
                            <label for="modalUnits">Units:</label>
                            <select class="form-control" id="modalUnits">
                                <option value="per_datacenter">per Datacenter</option>
                                <option value="per_room">per Room</option>
                                <option value="per_row">per Row</option>
                                <option value="per_server">per Server</option>
                                <option value="per_rack">per Rack</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="modalCostPerEquipment">Cost per Equipment:</label>
                            <input type="text" class="form-control" id="modalCostPerEquipment">
                        </div>
                        <div class="form-group">
                            <label for="modalRedundancy">Redundancy:</label>
                            <select class="form-control" id="modalRedundancy">
                                <option value="N">N</option>
                                <option value="N+1">N+1</option>
                                <option value="N+2">N+2</option>
                                <option value="2N">2N</option>
                                <option value="2N+1">2N+1</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="modalMTBF">MTBF:</label>
                            <input type="text" class="form-control" id="modalMTBF">
                        </div>
                        <div class="form-group">
                            <label for="modalGamma">Gamma (hours):</label>
                            <input type="text" class="form-control" id="modalGamma">
                        </div>
                        <div class="form-group">
                            <label for="modalBeta">Beta:</label>
                            <input type="text" class="form-control" id="modalBeta">
                        </div>
                        <div class="form-group">
                            <label for="modalEta">Eta (hours):</label>
                            <input type="text" class="form-control" id="modalEta">
                        </div>
                        <div class="form-group">
                            <label for="modalCostPerMaintenanceEvent">Cost per Maintenance Event:</label>
                            <input type="text" class="form-control" id="modalCostPerMaintenanceEvent">
                        </div>
                        <div class="form-group">
                            <label for="modalMaintenanceType">Maintenance Type:</label>
                            <select class="form-control" id="modalMaintenanceType">
                                <option value="Cost per maintenance">Cost per maintenance</option>
                                <option value="% of purchase price">% of purchase price</option>
                                <option value="Flat fee per year">Flat fee per year</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitModalForm()">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <script>
        let currentFileInput;

        function saveState() {
            const formData = new FormData(document.getElementById('fileForm'));
            const table1Data = document.getElementById('file1-details').innerHTML;
            const table2Data = document.getElementById('file2-details').innerHTML;
            const totalCost1 = document.getElementById('file1-totalCost').textContent;
            const totalCost2 = document.getElementById('file2-totalCost').textContent;

            sessionStorage.setItem('formData', JSON.stringify(Object.fromEntries(formData.entries())));
            sessionStorage.setItem('table1Data', table1Data);
            sessionStorage.setItem('table2Data', table2Data);
            sessionStorage.setItem('totalCost1', totalCost1);
            sessionStorage.setItem('totalCost2', totalCost2);
        }

        function restoreState() {
            const formData = JSON.parse(sessionStorage.getItem('formData'));
            const table1Data = sessionStorage.getItem('table1Data');
            const table2Data = sessionStorage.getItem('table2Data');
            const totalCost1 = sessionStorage.getItem('totalCost1');
            const totalCost2 = sessionStorage.getItem('totalCost2');

            if (formData) {
                for (const [key, value] of Object.entries(formData)) {
                    document.querySelector(`[name="${key}"]`).value = value;
                }
            }
            if (table1Data) {
                document.getElementById('file1-details').innerHTML = table1Data;
            }
            if (table2Data) {
                document.getElementById('file2-details').innerHTML = table2Data;
            }
            if (totalCost1) {
                document.getElementById('file1-totalCost').textContent = totalCost1;
            }
            if (totalCost2) {
                document.getElementById('file2-totalCost').textContent = totalCost2;
            }
        }

        document.addEventListener('DOMContentLoaded', restoreState);

        function showFileModal(input, fileId) {
            currentFileInput = input;
            currentFileInput.fileId = fileId;
            $('#fileInputModal').modal('show');
        }

        function submitFileModalForm() {
            const file = currentFileInput.files[0];
            if (file) {
                const formData = new FormData();
                formData.append('file1', file);

                const mtbf = document.getElementById('fileModalMTBF').value || 'defaultMTBF';
                const gamma = document.getElementById('fileModalGamma').value || 'defaultGamma';
                const beta = document.getElementById('fileModalBeta').value || 'defaultBeta';
                const eta = document.getElementById('fileModalEta').value || 'defaultEta';
                const costPerMaintenanceEvent = document.getElementById('fileModalCostPerMaintenanceEvent').value || 'defaultCostPerMaintenanceEvent';

                formData.append('mtbf', mtbf);
                formData.append('gamma', gamma);
                formData.append('beta', beta);
                formData.append('eta', eta);
                formData.append('costPerMaintenanceEvent', costPerMaintenanceEvent);

                // Check if the file is an HTM or SQL file
                const isHTM = file.name.endsWith('.htm') || file.name.endsWith('.html');
                const isSQL = file.name.endsWith('.sql') || file.name.endsWith('.sqlite');

                if (isHTM || isSQL) {
                    fetch('/process_file', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log("File processed successfully", data);
                        if (file.name === 'file1') {
                            displayCoolingSystemDetails(data, 'file1-details');
                        } else if (file.name === 'file2') {
                            displayCoolingSystemDetails(data, 'file2-details');
                        }
                        calculateTotalCost(data.total_cooling_cost);
                        plotResults(data.roi, data.irr, data.net_npv, data.n_time);
                    })
                    .catch(error => {
                        console.error("Error occurred while processing file", error);
                    });

                    $('#fileInputModal').modal('hide');
                } else {
                    alert("Please upload a valid HTM or SQL file.");
                }
            }
        }

        function showAddModal() {
            $('#inputModal').modal('show');
        }

        function submitModalForm() {
            const name = document.getElementById('modalName').value;
            const units = document.getElementById('modalUnits').value;
            const costPerEquipment = document.getElementById('modalCostPerEquipment').value;
            const redundancy = document.getElementById('modalRedundancy').value;
            const mtbf = document.getElementById('modalMTBF').value;
            const gamma = document.getElementById('modalGamma').value;
            const beta = document.getElementById('modalBeta').value;
            const eta = document.getElementById('modalEta').value;
            const costPerMaintenanceEvent = document.getElementById('modalCostPerMaintenanceEvent').value;
            const maintenanceType = document.getElementById('modalMaintenanceType').value;

            if (name && units && costPerEquipment && redundancy && mtbf && gamma && beta && eta && costPerMaintenanceEvent && maintenanceType) {
                const newEntry = {
                    name,
                    units,
                    costPerEquipment,
                    redundancy,
                    mtbf,
                    gamma,
                    beta,
                    eta,
                    costPerMaintenanceEvent,
                    maintenanceType
                };

                fetch('/add_cooling_system', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newEntry)
                })
                .then(response => response.json())
                .then(data => {
                    console.log("Server response received", data);
                    displayCoolingSystemDetails(data.cooling_system_details, 'file1-details');
                    calculateTotalCost(data.total_cooling_cost);
                    plotResults(data.roi, data.irr, data.net_npv, data.n_time);
                })
                .catch(error => {
                    console.error("Error occurred:", error);
                });

                $('#inputModal').modal('hide');
            } else {
                alert("All values are required.");
            }
        }

        function removeHiddenInputs(fileId) {
            const hiddenInputs = document.querySelectorAll(`#${fileId}-group input[type='hidden']`);
            hiddenInputs.forEach(input => input.remove());
        }

        function addHiddenInput(fileId, name, value) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.id = `${fileId}-${name}`;
            input.name = name;
            input.value = value;
            document.getElementById(fileId + '-group').appendChild(input);
        }

        function handleFormSubmit(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            fetch('/process_file', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log("Form submitted successfully", data);
                plotResults(data.roi, data.irr, data.net_npv, data.n_time);
            })
            .catch(error => {
                console.error("Error occurred:", error);
            });
        }

        function displayCoolingSystemDetails(details, tableId) {
            let tbody = "";
            details.forEach((row, index) => {
                tbody += "<tr>";
                tbody += `<td class="checkbox-column"><input type="checkbox" class="selectRow${tableId}"></td>`;
                tbody += `<td>${row.Name}</td>`;
                tbody += `<td>${row.Units}</td>`;
                tbody += `<td>${row.Cost_per_equipment}</td>`;
                tbody += `<td>${row.Redundancy}</td>`;
                tbody += `<td>${row.MTBF}</td>`;
                tbody += `<td>${row.Gamma}</td>`;
                tbody += `<td>${row.Beta}</td>`;
                tbody += `<td>${row.Eta}</td>`;
                tbody += `<td>${row.Cost_per_maintenance_event}</td>`;
                tbody += `<td>${row.Total_cost_of_cooling_system}</td>`;
                tbody += "</tr>";
            });

            document.getElementById(tableId).innerHTML = tbody;
            updateTotalCost(tableId);
        }

        function updateTotalCost(tableId) {
            const rows = document.querySelectorAll(`#${tableId} tr`);
            let totalCost = 0;
            rows.forEach(row => {
                const cells = row.children;
                const costPerEquipment = parseFloat(cells[2].textContent.replace(/[^0-9.-]+/g, ""));
                const redundancy = cells[3].textContent;
                let multiplier = 1;
                if (redundancy === "N+1") {
                    multiplier = 2;
                } else if (redundancy === "N+2") {
                    multiplier = 3;
                } else if (redundancy === "2N") {
                    multiplier = 2;
                } else if (redundancy === "2N+1") {
                    multiplier = 3;
                }
                const totalCostForRow = costPerEquipment * multiplier;
                cells[10].textContent = `$${totalCostForRow.toFixed(2)}`;
                totalCost += totalCostForRow;
            });
            document.getElementById(`${tableId}-totalCost`).textContent = `$${totalCost.toFixed(2)}`;
        }

        function calculateTotalCost(totalCost) {
            document.getElementById('file1-totalCost').textContent = totalCost;
            document.getElementById('file2-totalCost').textContent = totalCost;
        }

        function clearTable(fileId) {
            document.getElementById(`${fileId}-details`).innerHTML = "";
            document.getElementById(`${fileId}-totalCost`).textContent = "";
        }

        function removeSelectedRows(fileId) {
            const selectedRows = document.querySelectorAll(`#${fileId}-details .selectRow${fileId}:checked`);
            const indicesToRemove = Array.from(selectedRows).map(row => {
                return Array.from(row.closest('tr').parentNode.children).indexOf(row.closest('tr'));
            });

            if (indicesToRemove.length > 0) {
                fetch('/remove_cooling_system', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ indices: indicesToRemove, fileId: fileId })
                })
                .then(response => response.json())
                .then(data => {
                    console.log("Rows removed successfully", data);
                    displayCoolingSystemDetails(data.cooling_system_details, fileId);
                    calculateTotalCost(data.total_cooling_cost);
                    plotResults(data.roi, data.irr, data.net_npv, data.n_time);
                })
                .catch(error => {
                    console.error("Error occurred while removing rows", error);
                });
            }
        }

        function makeEditable(cell) {
            const originalContent = cell.textContent;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = originalContent;
            input.className = 'form-control editable';
            input.addEventListener('blur', function() {
                cell.textContent = input.value;
                updateCell(cell, input.value);
                updateTotalCost(cell.closest('tbody').id.replace('-details', ''));
            });
            input.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    cell.textContent = input.value;
                    updateCell(cell, input.value);
                    updateTotalCost(cell.closest('tbody').id.replace('-details', ''));
                } else if (event.key === 'Escape') {
                    cell.textContent = originalContent;
                }
            });
            cell.textContent = '';
            cell.appendChild(input);
            input.focus();
        }

        function updateCell(cell, newValue) {
            const row = cell.parentNode;
            const table = row.parentNode;
            const rowIndex = Array.prototype.indexOf.call(table.children, row);
            const cellIndex = Array.prototype.indexOf.call(row.children, cell);

            fetch('/update_cell', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    rowIndex: rowIndex,
                    cellIndex: cellIndex,
                    newValue: newValue
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log("Cell updated successfully", data);
            })
            .catch(error => {
                console.error("Error occurred while updating cell", error);
            });
        }

        function updateRedundancy(rowIndex, redundancy) {
            fetch('/update_redundancy', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    index: rowIndex,
                    redundancy: redundancy
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log("Redundancy updated successfully", data);
                displayCoolingSystemDetails(data.cooling_system_details, 'file1-details');
                calculateTotalCost(data.total_cooling_cost);
                plotResults(data.roi, data.irr, data.net_npv, data.n_time);
            })
            .catch(error => {
                console.error("Error occurred while updating redundancy", error);
            });
        }

        function updateMaintenanceType(rowIndex, maintenanceType) {
            fetch('/update_maintenance_type', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    index: rowIndex,
                    maintenanceType: maintenanceType
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log("Maintenance type updated successfully", data);
                displayCoolingSystemDetails(data.cooling_system_details, 'file1-details');
                calculateTotalCost(data.total_cooling_cost);
                plotResults(data.roi, data.irr, data.net_npv, data.n_time);
            })
            .catch(error => {
                console.error("Error occurred while updating maintenance type", error);
            });
        }

        function plotResults(roi, irr, net_npv, n_time) {
            // Plot ROI
            const roiData = [{
                x: n_time,
                y: roi,
                type: 'scatter'
            }];
            const roiLayout = {
                title: 'ROI over Time',
                xaxis: { title: 'Year' },
                yaxis: { title: 'ROI' }
            };
            Plotly.newPlot('roi-graph', roiData, roiLayout);

            // Plot IRR
            const irrData = [{
                x: n_time,
                y: irr,
                type: 'scatter'
            }];
            const irrLayout = {
                title: 'IRR over Time',
                xaxis: { title: 'Year' },
                yaxis: { title: 'IRR' }
            };
            Plotly.newPlot('irr-graph', irrData, irrLayout);

            // Plot NPV
            const npvData = [{
                x: n_time,
                y: net_npv,
                type: 'scatter'
            }];
            const npvLayout = {
                title: 'NPV over Time',
                xaxis: { title: 'Year' },
                yaxis: { title: 'NPV' }
            };
            Plotly.newPlot('npv-graph', npvData, npvLayout);
        }
    </script>
</body>
</html>
