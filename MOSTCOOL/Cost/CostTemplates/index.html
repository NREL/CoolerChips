<!-- Cost/CostTemplates/index.html -->
{% extends "base_template.html" %}

{% block title %}Cost Model Demonstration V1.1{% endblock %}

{% block sidebar %}
<li class="nav-item">
    <a href="/results/cost/" class="nav-link active">Cost Model Home</a>
</li>
<li class="nav-item">
  <a href="/results/cost/settings" class="nav-link">Settings</a>
</li>
<li class="nav-item">
  <a href="/results/cost/elements.html" class="nav-link">Cost Elements Menu</a>
</li>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mt-4">Cost Analysis V1.1</h1>

    <div class="mt-3">
        <a href="/results/cost/settings" class="btn btn-secondary" onclick="saveState()">Settings</a>
        <a href="/results/cost/elements.html" class="btn btn-secondary" onclick="saveState()">Cost Elements Menu</a>
        <button class="btn btn-secondary" id="saveBtn" onclick="saveState()">Save</button>
        <button class="btn btn-secondary" id="loadBtn">Load</button>
    </div>

    <form id="fileForm" method="post" action="/results/cost/process_file" onsubmit="return handleFormSubmit(event);">
        <div class="form-group" id="file1-group">
            <label for="file1">Add the first HTM/SQL file:</label>
            <input type="file" class="form-control" id="file1" name="file1" onchange="showModal(this, 'file1')">
            <div class="mt-2 mb-2">
                <button type="button" class="btn btn-primary">Add</button>
                <button type="button" class="btn btn-danger" onclick="clearTable('file1')">Remove</button>
                <button type="button" class="btn btn-warning" onclick="clearTable('file1')">Clear</button>
            </div>
            <div class="table-container">
                <table class="table table-bordered" id="file1-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Cost per Equipment</th>
                            <th>Redundancy</th>
                            <th>MTBF</th>
                            <th>Gamma (hours)</th>
                            <th>Beta</th>
                            <th>Eta (hours)</th>
                            <th>Cost per Maintenance Event</th>
                            <th>Total Cost</th>
                        </tr>
                    </thead>
                    <tbody id="file1-details">
                        {% for row in table_data[1:] %}
                            <tr>
                                {% for cell in row %}
                                    <td>{{ cell }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="8">Total</th>
                            <th id="file1-totalCost">{{ table_data|length > 1 and table_data[-1][-1] }}</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div class="form-group" id="file2-group">
            <label for="file2">Add the second HTM/SQL file:</label>
            <input type="file" class="form-control" id="file2" name="file2" onchange="showModal(this, 'file2')">
            <div class="mt-2 mb-2">
                <button type="button" class="btn btn-primary">Add</button>
                <button type="button" class="btn btn-danger" onclick="clearTable('file2')">Remove</button>
                <button type="button" class="btn btn-warning" onclick="clearTable('file2')">Clear</button>
            </div>
            <div class="table-container">
                <table class="table table-bordered" id="file2-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Cost per Equipment</th>
                            <th>Redundancy</th>
                            <th>MTBF</th>
                            <th>Gamma (hours)</th>
                            <th>Beta</th>
                            <th>Eta (hours)</th>
                            <th>Cost per Maintenance Event</th>
                            <th>Total Cost</th>
                        </tr>
                    </thead>
                    <tbody id="file2-details">
                        <!-- Data will be inserted here -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="8">Total</th>
                            <th id="file2-totalCost"></th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>

    <div class="graph-container">
        <h2>Graphs</h2>
        <div>
            <h3>ROI vs Time</h3>
            <img id="roi-graph" src="data:image/png;base64,{{ roi_image }}" alt="ROI Graph">
        </div>
        <div>
            <h3>IRR vs Time</h3>
            <img id="irr-graph" src="data:image/png;base64,{{ irr_image }}" alt="IRR Graph">
        </div>
        <div>
            <h3>Net NPV vs Time</h3>
            <img id="npv-graph" src="data:image/png;base64,{{ npv_image }}" alt="NPV Graph">
        </div>
    </div>
</div>

<!-- Modal for input -->
<div class="modal fade" id="inputModal" tabindex="-1" role="dialog" aria-labelledby="inputModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="inputModalLabel">Enter Values</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="modalForm">
                    <div class="form-group">
                        <label for="modalMTBF">MTBF:</label>
                        <input type="text" class="form-control" id="modalMTBF">
                    </div>
                    <div class="form-group">
                        <label for="modalGamma">Gamma (hours):</label>
                        <input type="text" class="form-control" id="modalGamma">
                    </div>
                    <div class="form-group">
                        <label for="modalBeta">Beta:</label>
                        <input type="text" class="form-control" id="modalBeta">
                    </div>
                    <div class="form-group">
                        <label for="modalEta">Eta (hours):</label>
                        <input type="text" class="form-control" id="modalEta">
                    </div>
                    <div class="form-group">
                        <label for="modalCostPerMaintenanceEvent">Cost per Maintenance Event:</label>
                        <input type="text" class="form-control" id="modalCostPerMaintenanceEvent">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="submitModalForm()">Submit</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="{{ url_for('static', filename='js/custom_cost.js') }}"></script>
{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/custom_cost.css') }}">
{% endblock %}
